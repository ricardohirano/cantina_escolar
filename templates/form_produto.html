{% extends "partials/_base.html" %}
{% block content %}
<div class="container mt-4" style="max-width: 760px;">
  <h3 class="mb-3">{{ 'Editar produto' if produto else 'Novo produto' }}</h3>

  {% with msgs = get_flashed_messages(with_categories=true) %}
    {% if msgs %}
      {% for cat, msg in msgs %}
        <div class="alert alert-{{ 'danger' if cat=='error' else cat }} py-2">{{ msg }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <form method="post" enctype="multipart/form-data">
    <div class="mb-3">
      <label class="form-label">Nome</label>
      <input name="nome" class="form-control" required
             value="{{ produto.nome if produto else '' }}">
    </div>

    <div class="mb-3">
      <label class="form-label">Preço</label>
      <input name="preco" type="number" step="0.01" class="form-control" required
             value="{{ produto.preco if produto else '' }}">
    </div>

    <div class="mb-3">
      <label class="form-label">Categoria</label>
      <select name="categoria" class="form-select">
        {% for c in categorias %}
          <option value="{{ c }}" {% if produto and produto.categoria == c %}selected{% endif %}>{{ c }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label">Foto do produto</label>
      <input type="file" name="foto" accept="image/*" class="form-control">
      {% if produto and produto.foto_url %}
        <img src="{{ produto.foto_url }}?v={{ produto.id }}" alt="Foto atual"
             style="width:100px; height:100px; object-fit:cover; border-radius:8px; margin-top:10px;">
      {% endif %}
    </div>

    <div class="mb-3">
      <label class="form-label">Descrição</label>
      <textarea name="descricao" class="form-control" rows="3">{{ produto.descricao if produto else '' }}</textarea>
    </div>

    <div class="form-check my-2">
      <input class="form-check-input" type="checkbox" id="disponivel" name="disponivel"
             {% if not produto or produto.disponivel %}checked{% endif %}>
      <label class="form-check-label" for="disponivel">Disponível no cardápio</label>
    </div>

    <button class="btn btn-primary mt-3" type="submit">Salvar</button>
    <a class="btn btn-secondary mt-3" href="{{ url_for('produto.listar') }}">Cancelar</a>
  </form>
</div>
{% endblock %}
